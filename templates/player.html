<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Nexfix MP4HUB</title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="/static/videojs/video-js.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <header class="nexfix-header" role="banner">
        <div class="header-left">
            <img src="/static/logo.svg" alt="Nexfix MP4HUB Logo" class="brand-logo">
            <h1 class="brand-title">Nexfix MP4HUB</h1>
        </div>
        <div class="content-type">
            <button class="content-type-btn" id="contentTypeBtn" aria-label="Select content type" aria-expanded="false">
                <span class="material-icons">movie</span>
                <span>Movies</span>
                <span class="material-icons">arrow_drop_down</span>
            </button>
            <div class="content-type-dropdown hidden" id="contentTypeDropdown" role="menu">
                <div class="content-type-item active" data-type="movies" role="menuitem" tabindex="0">
                    <span class="material-icons">movie</span>
                    <span>Movies</span>
                </div>
                <div class="content-type-item" data-type="albums" role="menuitem" tabindex="0">
                    <span class="material-icons">album</span>
                    <span>Albums</span>
                </div>
                <div class="content-type-item" data-type="tv" role="menuitem" tabindex="0">
                    <span class="material-icons">live_tv</span>
                    <span>TV Shows</span>
                </div>
                <div class="content-type-item" data-type="live" role="menuitem" tabindex="0">
                    <span class="material-icons">sensors</span>
                    <span>Live Streams</span>
                </div>
            </div>
        </div>
    </header>

    <div class="telegram-join-banner" role="complementary">
        <img src="/static/Telegram_logo.png" alt="Telegram Logo" class="telegram-logo">
        <div class="telegram-text">
            <p>Stay Updated â€” Join Us on Telegram</p>
            <div class="telegram-links">
                <a href="https://t.me/TeraBoX_dlFree_bot" target="_blank" class="telegram-btn" rel="noopener noreferrer">Our Telegram Bot</a>
                <a href="https://t.me/freeDL_1" target="_blank" class="telegram-btn" rel="noopener noreferrer">Main Channel</a>
            </div>
        </div>
    </div>

    <div id="videoPlayer" class="video_player" role="region" aria-label="Video player">
        <div class="error-overlay hidden" aria-live="assertive">
            <span class="error-message"></span>
        </div>
        <div class="loading-spinner hidden" aria-label="Loading video"></div>
        <div class="context-menu hidden" aria-hidden="true" style="display: none;">
            <ul role="menu">
                <li data-action="play-pause" role="menuitem" tabindex="0">Play/Pause</li>
                <li data-action="add-bookmark" role="menuitem" tabindex="0">Add Bookmark</li>
                <li data-action="add-annotation" role="menuitem" tabindex="0">Add Annotation</li>
                <li data-action="toggle-pip" role="menuitem" tabindex="0">Picture-in-Picture</li>
                <li data-action="toggle-fullscreen" role="menuitem" tabindex="0">Fullscreen</li>
                <li data-action="show-shortcuts" role="menuitem" tabindex="0">Keyboard Shortcuts</li>
                <li data-action="capture-screenshot" role="menuitem" tabindex="0">Capture Screenshot</li>
                <li data-action="share-video" role="menuitem" tabindex="0">Share Video</li>
            </ul>
        </div>
        <video id="mainPlayer" class="video-js vjs-big-play-centered" playsinline preload="auto" aria-label="Main video player">
            <source src="" type="application/x-mpegURL">
            <p class="vjs-no-js">
                To view this video please enable JavaScript, and consider upgrading to a web browser that
                <a href="https://videojs.com/html5-video-support/" target="_blank" rel="noopener noreferrer">supports HTML5 video</a>
            </p>
        </video>
        <div id="iframePlayerContainer" class="iframe-player-container hidden" aria-label="Embedded video player">
            <iframe id="iframePlayer" frameborder="0" allowfullscreen aria-label="Embedded video content"></iframe>
        </div>
        <button id="centerControl" class="center-control" aria-label="Play" role="button" tabindex="0">
            <span class="material-icons">play_arrow</span>
        </button>
        <div id="qualityBadge" class="quality-badge" aria-live="polite">Auto</div>
        <div class="annotation-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100;"></div>
        <button id="skipAdBtn" class="skip-ad-btn hidden" disabled aria-label="Skip advertisement">
            <span class="skip-ad-text" id="skipAdTimer">Skip in 5s</span>
            <span class="skip-ad-active">Skip Ad</span>
        </button>
        <div id="volumeOverlay" class="swipe-overlay hidden" aria-hidden="true">
            <div id="volumeIndicator" class="swipe-indicator">
                <span class="material-icons" id="volumeIcon">volume_up</span>
                <span id="volumeValue">80%</span>
            </div>
            <div class="volume-bar"></div>
        </div>
        <div id="brightnessOverlay" class="swipe-overlay hidden" aria-hidden="true">
            <div id="brightnessIndicator" class="swipe-indicator">
                <span class="material-icons" id="brightnessIcon">brightness_5</span>
                <span id="brightnessValue">100%</span>
            </div>
            <div class="brightness-bar"></div>
        </div>
        <div id="rewindIndicator" class="tap-indicator left hidden" aria-hidden="true">
            <div class="tap-indicator-content">
                <span class="material-icons">fast_rewind</span>
                <span id="rewindValue">-10s</span>
            </div>
        </div>
        <div id="forwardIndicator" class="tap-indicator right hidden" aria-hidden="true">
            <div class="tap-indicator-content">
                <span class="material-icons">fast_forward</span>
                <span id="forwardValue">+10s</span>
            </div>
        </div>
        <div id="seekFeedbackLeft" class="seek-feedback left hidden" aria-hidden="true"></div>
        <div id="seekFeedbackRight" class="seek-feedback right hidden" aria-hidden="true"></div>
        <div id="speedFeedback" class="speed-feedback hidden" aria-hidden="true"></div>
        <div id="lockOverlay" class="lock-overlay hidden" aria-hidden="true"></div>
        <div id="adOverlay" class="ad-overlay hidden" aria-hidden="true">
            <span id="adText" class="ad-label">Advertisement</span>
            <span id="adTimer" class="ad-timer">5s</span>
        </div>
        <div id="orientationFeedback" class="orientation-feedback hidden" aria-hidden="true"></div>
        <div class="controls hidden" role="toolbar">
            <div id="progressArea" class="progress-area" role="slider" aria-valuemin="0" aria-label="Video progress">
                <div class="bufferedBar"></div>
                <div class="progress-bar"><span></span></div>
            </div>
            <div class="controls-list">
                <div class="controls-left">
                    <button class="icon fast-rewind" aria-label="Rewind 10 seconds" role="button" tabindex="0">
                        <span class="material-icons">fast_rewind</span>
                    </button>
                    <div class="timer" aria-live="polite">
                        <span class="current" aria-label="Current time">0:00</span>/<span class="duration" aria-label="Total duration">0:00</span>
                    </div>
                    <div class="live-indicator hidden" id="liveBtn" role="status">
                        <span class="material-icons">sensors</span>
                        LIVE <span id="liveTimer" aria-label="Live duration">0:00</span>
                    </div>
                </div>
                <div class="controls-right">
                    <div class="volume" role="group">
                        <button class="icon" aria-label="Toggle mute" role="button" tabindex="0">
                            <span class="material-icons">volume_up</span>
                        </button>
                        <div class="volume-popup">
                            <input type="range" class="volume-slider" min="0" max="100" value="80" aria-label="Volume control" role="slider">
                            <span class="volume-percentage" aria-hidden="true">80%</span>
                        </div>
                    </div>
                    <button class="icon audioTrackBtn" id="audioTrackBtn" aria-label="Open audio tracks menu" role="button" tabindex="0">
                        <span class="material-icons">audiotrack</span>
                    </button>
                    <button class="icon settingsBtn" id="settingsBtn" aria-label="Open settings" role="button" tabindex="0">
                        <span class="material-icons">settings</span>
                    </button>
                    <button class="icon captionsBtn" id="captionsBtn" aria-label="Open captions menu" role="button" tabindex="0">
                        <span class="material-icons">closed_caption</span>
                    </button>
                    <button class="icon picture_in_picture" aria-label="Toggle Picture-in-Picture" role="button" tabindex="0">
                        <span class="material-icons">picture_in_picture_alt</span>
                    </button>
                    <button class="icon theater-mode" aria-label="Toggle theater mode" role="button" tabindex="0">
                        <span class="material-icons">theater_comedy</span>
                    </button>
                    <button class="icon fullscreen" aria-label="Enter fullscreen" role="button" tabindex="0">
                        <span class="material-icons">fullscreen</span>
                    </button>
                    <button class="icon screenshot-btn" id="screenshotBtn" aria-label="Capture screenshot" role="button" tabindex="0">
                        <span class="material-icons">camera_alt</span>
                    </button>
                    <button class="icon share-btn" id="shareBtn" aria-label="Share video" role="button" tabindex="0">
                        <span class="material-icons">share</span>
                    </button>
                    <button class="icon" id="lockBtn" aria-label="Lock controls" role="button" tabindex="0">
                        <span class="material-icons">lock_open</span>
                    </button>
                    <button class="icon" id="orientationBtn" aria-label="Lock orientation" role="button" tabindex="0">
                        <span class="material-icons">screen_rotation</span>
                    </button>
                </div>
            </div>
        </div>
        <div id="settingsPanel" class="settings hidden" role="dialog" aria-label="Settings panel">
            <div class="settings-panel active" data-label="settingHome" aria-expanded="true">
                <div class="settings-header">Settings</div>
                <ul role="menu">
                    <li data-label="playbackSpeed" role="menuitem" tabindex="0">Playback Speed</li>
                    <li data-label="qualityMenu" role="menuitem" tabindex="0">Quality</li>
                    <li id="statsToggle" role="menuitem" tabindex="0">Show Technical Stats</li>
                    <li id="chapterMarkersToggle" class="active" role="menuitem" tabindex="0">Chapter Markers <span class="material-icons">check</span></li>
                    <li id="swipeControlsToggle" class="active" role="menuitem" tabindex="0">Swipe Controls <span class="material-icons">check</span></li>
                    <li id="autoQualityToggle" class="active" role="menuitem" tabindex="0">Auto Quality <span class="material-icons">check</span></li>
                    <li id="orientationLockToggle" role="menuitem" tabindex="0">Orientation Lock</li>
                    <li id="loopToggle" role="menuitem" tabindex="0">Loop Playback</li>
                </ul>
            </div>
            <div class="settings-panel" data-label="playbackSpeed" aria-expanded="false">
                <div class="settings-header">
                    <span class="material-icons back-arrow" data-label="settingHome" role="button" aria-label="Back to main settings" tabindex="0">arrow_back</span> Playback Speed
                </div>
                <ul role="menu">
                    <li data-speed="0.25" role="button" tabindex="0">0.25x</li>
                    <li data-speed="0.5" role="button" tabindex="0">0.5x</li>
                    <li data-speed="0.75" role="button" tabindex="0">0.75x</li>
                    <li data-speed="1" class="active" role="button" tabindex="0">1x <span class="material-icons">check</span></li>
                    <li data-speed="1.25" role="button" tabindex="0">1.25x</li>
                    <li data-speed="1.5" role="button" tabindex="0">1.5x</li>
                    <li data-speed="1.75" role="button" tabindex="0">1.75x</li>
                    <li data-speed="2" role="button" tabindex="0">2x</li>
                    <li class="custom-speed-input" role="menuitem" tabindex="0">
                        <input type="number" id="customSpeedInput" step="0.1" min="0.1" max="8" placeholder="Custom speed" aria-label="Custom playback speed">
                        <button id="saveCustomSpeedBtn" aria-label="Apply custom speed"><span class="material-icons">check</span></button>
                    </li>
                </ul>
            </div>
            <div class="settings-panel" data-label="qualityMenu" aria-expanded="false">
                <div class="settings-header">
                    <span class="material-icons back-arrow" data-label="settingHome" role="button" aria-label="Back to main settings" tabindex="0">arrow_back</span> Video Quality
                </div>
                <ul id="qualityMenu" role="menu">
                    <!-- Populated dynamically -->
                </ul>
            </div>
        </div>
        <div class="captions hidden" id="captionsPanel" role="dialog" aria-label="Subtitles panel">
            <div class="settings-header">Subtitles</div>
            <ul id="captionMenu" role="menu"></ul>
        </div>
        <div class="audio-tracks hidden" id="audioTracksPanel" role="dialog" aria-label="Audio tracks panel">
            <div class="settings-header">Audio Tracks</div>
            <ul id="audioTrackMenu" role="menu"></ul>
        </div>
        <div id="keyboardShortcutsOverlay" class="keyboard-shortcuts-overlay hidden" role="dialog" aria-label="Keyboard shortcuts" aria-hidden="true" style="display: none;">
            <div class="shortcuts-content">
                <h3>Keyboard Shortcuts</h3>
                <ul>
                    <li><strong>Space</strong>: Play/Pause</li>
                    <li><strong>M</strong>: Mute/Unmute</li>
                    <li><strong>F</strong>: Toggle Fullscreen</li>
                    <li><strong>T</strong>: Toggle Theater Mode</li>
                    <li><strong>L</strong>: Lock/Unlock Controls</li>
                    <li><strong>Left Arrow</strong>: Rewind 5s</li>
                    <li><strong>Right Arrow</strong>: Forward 5s</li>
                    <li><strong>Up Arrow</strong>: Volume Up</li>
                    <li><strong>Down Arrow</strong>: Volume Down</li>
                    <li><strong>B</strong>: Add Bookmark</li>
                    <li><strong>S</strong>: Show Shortcuts</li>
                    <li><strong>C</strong>: Capture Screenshot</li>
                    <li><strong>H</strong>: Share Video</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="stats-panel hidden" id="statsPanel" role="complementary" aria-label="Technical statistics">
        <div class="stat-item"><span class="material-icons">play_arrow</span> Playback: <span id="playbackRate">1x</span></div>
        <div class="stat-item"><span class="material-icons">volume_up</span> Volume: <span id="currentVolume">80%</span></div>
        <div class="stat-item"><span class="material-icons">brightness_5</span> Brightness: <span id="currentBrightness">100%</span></div>
        <div class="stat-item"><span class="material-icons">timer</span> Time: <span id="currentTime">0:00</span></div>
        <div class="stat-item"><span class="material-icons">hourglass_empty</span> Duration: <span id="videoDuration">0:00</span></div>
        <div class="stat-item"><span class="material-icons">signal_cellular_alt</span> Buffer: <span id="bufferHealth">0s</span></div>
        <div class="stat-item"><span class="material-icons">high_quality</span> Quality: <span id="currentQuality">Auto</span></div>
        <div class="stat-item"><span class="material-icons">network_check</span> Network: <span id="networkStatus">Unknown</span></div>
    </div>

    <div class="downloader" id="downloader_button" role="region" aria-label="Download options">
        <div class="download-btn-container">
            <button id="hdDownloadBtn" aria-label="Download in HD quality">HD Downloader</button>
        </div>
        <div class="download-btn-container">
            <button id="fastDownloadBtn" aria-label="Download quickly">Fast Downloader</button>
        </div>
    </div>

    <div class="description-section" role="complementary">
        <h2 class="description-title" id="videoTitle">Loading...</h2>
        <p class="description-content" id="videoDescription">Loading video description...</p>
        <div class="error-message hidden" id="persistentError" aria-live="assertive"></div>
    </div>

    <script src="/static/videojs/video.min.js"></script>
    <script src="/static/videojs/videojs-contrib-hls.min.js"></script>
    <script src="/static/videojs/videojs-contrib-quality-levels.min.js"></script>
    <script src="/static/videojs/videojs-http-source-selector.min.js"></script>
    <script src="/static/scripts.js"></script>
    <script>
        // Request embed and initialize iframe player
        async function initIframePlayer() {
            try {
                const response = await fetch('/request-embed?iframe_url=https%3A%2F%2Fsportsipl.vercel.app%2Fstar.html&user_id=test_user');
                const data = await response.json();
                if (!response.ok) throw new Error(data.detail || 'Failed to request embed');
                setupIframePlayer(
                    { url: data.sources[0].url },
                    { title: data.title, description: data.description },
                    data.video_id
                );
            } catch (err) {
                console.error('Embed request failed:', err);
                document.querySelector('.error-message').textContent = 'Failed to load embedded video: ' + err.message;
                document.querySelector('.error-overlay').classList.remove('hidden');
            }
        }
        initIframePlayer();
    </script>
</body>
</html>