<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Nexfix - Premium streaming platform with watch party and video call features. Enjoy movies, series, and live events with friends in sync.">
    <meta name="keywords" content="movies, streaming, series, videos, watch party, video call">
    <title>Nexfix | Watch Together</title>
    
    <!-- Favicon -->
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/root.css">
    <link rel="stylesheet" href="/assets/css/footer.css">
    <link rel="stylesheet" href="/assets/css/nav.css">
    <link rel="stylesheet" href="/assets/css/right.css">
    <link rel="stylesheet" href="/assets/css/left.css">
    <link rel="stylesheet" href="/assets/css/party.css">
    <link rel="stylesheet" href="/assets/css/video.css">
    <link rel="stylesheet" href="/assets/css/chat.css">
</head>
<body class="dark-theme">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-animation">
            <div class="logo-spinner">
                <i class="material-icons-round">play_circle_filled</i>
            </div>
            <div class="nexfix-text">
                <span>N</span><span>e</span><span>x</span><span>f</span><span>i</span><span>x</span>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/" class="navbar-brand">
                <i class="material-icons-round">play_circle_filled</i>
                <span>Nexfix</span>
            </a>
            <div class="navbar-search">
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Search movies, shows..." aria-label="Search">
                    <button class="search-btn" aria-label="Search">
                        <i class="material-icons-round">search</i>
                    </button>
                    <div class="search-popup" id="search-popup"></div>
                </div>
            </div>
            <ul class="navbar-menu">
                <li><a href="/" class="active"><i class="material-icons-round">home</i> Home</a></li>
                <li class="dropdown">
                    <a href="#" aria-haspopup="true" aria-expanded="false"><i class="material-icons-round">category</i> Browse</a>
                    <div class="dropdown-menu">
                        <div class="dropdown-grid">
                            <div class="dropdown-section">
                                <h4>Movies</h4>
                                <a href="/movies/popular">Popular</a>
                                <a href="/movies/trending">Trending</a>
                                <a href="/movies/new">New Releases</a>
                            </div>
                            <div class="dropdown-section">
                                <h4>TV Shows</h4>
                                <a href="/tv/popular">Popular</a>
                                <a href="/tv/trending">Trending</a>
                                <a href="/tv/new">New Episodes</a>
                            </div>
                            <div class="dropdown-section">
                                <h4>Genres</h4>
                                <div class="genre-tags" id="genreTags"></div>
                            </div>
                        </div>
                    </div>
                </li>
                <li><a href="/watchlist"><i class="material-icons-round">bookmark</i> Watchlist</a></li>
                <li><a href="/live"><i class="material-icons-round">live_tv</i> Live</a></li>
                <li class="dropdown user-dropdown">
                    <a href="#" class="user-avatar" aria-haspopup="true" aria-expanded="false">
                        <img src="/assets/images/user.svg" id="userAvatar" alt="User profile">
                    </a>
                    <div class="dropdown-menu user-menu">
                        <div class="user-info">
                            <img src="https://icon2.cleanpng.com/20180320/jew/kisspng-shoulder-human-behavior-neck-conversation-sitting-user-mapping-5ab09bc0828695.7478563115215236485346.jpg" alt="User profile">
                            <div>
                                <h5 id="usernameDisplay">Guest</h5>
                                <small id="userEmailDisplay">guest@example.com</small>
                            </div>
                        </div>
                        <hr>
                        <a href="/profile"><i class="material-icons-round">person</i> Profile</a>
                        <a href="/settings"><i class="material-icons-round">settings</i> Settings</a>
                        <a href="/help"><i class="material-icons-round">help</i> Help</a>
                        <hr>
                        <a href="/logout" id="logoutBtn"><i class="material-icons-round">logout</i> Sign Out</a>
                    </div>
                </li>
                <li>
                    <button class="btn btn-primary" id="createPartyBtn">
                        <i class="material-icons-round">group</i>
                        <span>Create Party</span>
                    </button>
                </li>
                <li>
                    <button class="btn btn-primary" id="joinPartyBtn">
                        <i class="material-icons-round">group_add</i>
                        <span>Join Party</span>
                    </button>
                </li>
                <li>
                    <button id="themeToggle" aria-label="Toggle theme">
                        <i class="material-icons-round" id="themeIcon">dark_mode</i>
                    </button>
                </li>
                <li class="mobile-menu-toggle">
                    <button id="hamburger-menu" aria-label="Toggle menu">
                        <i class="material-icons-round">menu</i>
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="content-container">
            <!-- Left Section -->
            <section class="video-section left-section">
                <div class="video-player-container">
                    <video
                        id="mainPlayer"
                        class="video-js vjs-big-play-centered"
                        preload="auto"
                        poster="/static/images/video-poster.jpg"
                        data-setup='{"fluid": true, "responsive": true, "controlBar": false}'
                        aria-label="Main video player">
                        <source src="" type="video/mp4">
                        <p class="vjs-no-js">
                            To view this video please enable JavaScript, and consider upgrading to a web browser that
                            <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>.
                        </p>
                    </video>
                    <button class="vjs-big-play-button custom-big-play-button" aria-label="Play video">
                        <i class="material-icons-round">play_arrow</i>
                    </button>
                    <div class="custom-controls" id="customControls">
                        <div class="progress-container">
                            <input type="range" id="progressBar" min="0" max="1" value="0" step="0.01" aria-label="Seek video progress">
                        </div>
                        <div class="control-bar">
                            <button class="control-btn" id="playPauseBtn" aria-label="Play or Pause video">
                                <i class="material-icons-round">play_arrow</i>
                            </button>
                            <button class="control-btn" id="fastRewindBtn" aria-label="Rewind 10 seconds">
                                <i class="material-icons-round">replay_10</i>
                            </button>
                            <button class="control-btn" id="fastForwardBtn" aria-label="Forward 10 seconds">
                                <i class="material-icons-round">forward_10</i>
                            </button>
                            <div class="volume-control">
                                <button class="control-btn" id="muteBtn" aria-label="Mute or Unmute video">
                                    <i class="material-icons-round">volume_up</i>
                                </button>
                                <input type="range" id="volumeSlider" min="0" max="100" value="100" aria-label="Adjust volume">
                            </div>
                            <div class="time-display">
                                <span id="currentTime">0:00</span>
                                <span>/</span>
                                <span id="duration">0:00</span>
                            </div>
                            <button class="control-btn" id="theaterBtn" aria-label="Toggle theater mode">
                                <i class="material-icons-round">theater_comedy</i>
                            </button>
                            <button class="control-btn" id="loopBtn" aria-label="Toggle loop video">
                                <i class="material-icons-round">loop</i>
                            </button>
                            <button class="control-btn" id="pipBtn" aria-label="Toggle picture-in-picture mode">
                                <i class="material-icons-round">picture_in_picture</i>
                            </button>
                            <button class="control-btn" id="fullscreenBtn" aria-label="Toggle fullscreen mode">
                                <i class="material-icons-round">fullscreen</i>
                            </button>
                            <button class="control-btn" id="settingsBtn" aria-label="Open video settings">
                                <i class="material-icons-round">settings</i>
                            </button>
                            <button class="control-btn" id="videoCallBtn" aria-label="Start video call">
                                <i class="material-icons-round">videocam</i>
                            </button>
                            <button class="control-btn" id="toggleMicBtnSidebar" aria-label="Toggle microphone" data-enabled="true">
                                <i class="material-icons-round">mic</i>
                            </button>
                        </div>
                        <div class="settings-panel" id="settingsPanel">
                            <div class="settings-main active">
                                <div class="settings-section">
                                    <h6>Playback Speed</h6>
                                    <ul class="settings-options" id="playbackSpeedMenu">
                                        <li data-speed="0.5">0.5x</li>
                                        <li data-speed="0.75">0.75x</li>
                                        <li data-speed="1" class="active">1x</li>
                                        <li data-speed="1.25">1.25x</li>
                                        <li data-speed="1.5">1.5x</li>
                                        <li data-speed="2">2x</li>
                                    </ul>
                                </div>
                                <div class="settings-section">
                                    <h6>Quality</h6>
                                    <ul class="settings-options" id="qualityMenu">
                                        <li data-submenu="quality">Auto</li>
                                    </ul>
                                </div>
                                <div class="settings-section">
                                    <h6>Captions</h6>
                                    <ul class="settings-options" id="captionMenu">
                                        <li data-caption="off" class="active">Off</li>
                                        <li data-caption="en">English</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="settings-submenu" id="qualitySubmenu">
                                <div class="settings-section">
                                    <button class="back-btn" id="qualityBackBtn" aria-label="Back to settings">
                                        <i class="material-icons-round">arrow_back</i> Quality
                                    </button>
                                    <ul class="settings-options" id="qualityOptions">
                                        <li data-quality="auto" class="active">Auto</li>
                                        <li data-quality="144p">144p</li>
                                        <li data-quality="240p">240p</li>
                                        <li data-quality="360p">360p</li>
                                        <li data-quality="480p">480p</li>
                                        <li data-quality="720p">720p</li>
                                        <li data-quality="1080p">1080p</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="loading-spinner" id="loadingSpinner">
                        <div class="spinner"></div>
                        <p>Loading video...</p>
                    </div>
                    <div class="error-overlay" id="errorOverlay">
                        <div class="error-message">
                            <i class="material-icons-round">error_outline</i>
                            <p id="errorMessage">Failed to load video.</p>
                            <button class="btn btn-primary" id="retryBtn">Retry</button>
                        </div>
                    </div>
                </div>
                <div class="video-metadata">
                    <div class="metadata-header">
                        <h1 id="movie-title">Loading...</h1>
                        <div class="metadata-badges">
                            <span class="badge" id="movie-rating"></span>
                            <span class="badge" id="movie-quality"></span>
                            <span class="badge" id="movie-year"></span>
                            <span class="badge" id="movie-duration"></span>
                        </div>
                    </div>
                    <div class="metadata-actions">
                        <div class="action-buttons">
                            <button class="action-btn" id="likeBtn" aria-label="Like video">
                                <i class="material-icons-round">thumb_up</i>
                                <span id="likeCount">0</span>
                            </button>
                            <button class="action-btn" id="dislikeBtn" aria-label="Dislike video">
                                <i class="material-icons-round">thumb_down</i>
                                <span id="dislikeCount">0</span>
                            </button>
                            <button class="action-btn" id="favoriteBtn" aria-label="Add to favorites">
                                <i class="material-icons-round">favorite</i>
                                <span>Favorite</span>
                            </button>
                            <button class="action-btn" id="watchLaterBtn" aria-label="Add to watch later">
                                <i class="material-icons-round">watch_later</i>
                                <span>Watch Later</span>
                            </button>
                            <button class="action-btn" id="videoShareBtn" aria-label="Share video">
                                <i class="material-icons-round">share</i>
                                <span>Share</span>
                            </button>
                            <button class="action-btn" id="downloadBtn" aria-label="Download video">
                                <i class="material-icons-round">download</i>
                                <span>Download</span>
                            </button>
                            <button class="action-btn" id="liveChatBtn" aria-label="Open live chat">
                                <i class="material-icons-round">chat</i>
                                <span>Live Chat</span>
                            </button>
                        </div>
                        <div class="ratings">
                            <div class="imdb-rating">
                                <img src="/assets/images/imdb-logo.png" alt="IMDb logo" loading="lazy">
                                <span id="imdb-rating"></span>
                            </div>
                            <div class="user-rating">
                                <div class="stars" id="userRatingStars"></div>
                                <span id="user-count"></span>
                            </div>
                        </div>
                    </div>
                    <div class="metadata-description">
                        <h3>Overview</h3>
                        <p id="movie-description">Loading description...</p>
                    </div>
                    <div class="metadata-details">
                        <div class="detail-item">
                            <span class="detail-label">Director:</span>
                            <span id="movie-director"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Genres:</span>
                            <span id="movie-genres"></span>
                        </div>
                    </div>
                </div>
                <div class="watch-party-section">
                    <div class="watch-party-header">
                        <h3><i class="bx bx-group"></i> Watch Party</h3>
                        <div class="party-status" id="currentPartyStatus">
                            <span>Not in a party</span>
                        </div>
                    </div>
                    <p>Sync your viewing experience with friends and chat live!</p>
                    <div class="watch-party-buttons">
                        <button class="btn btn-primary" id="createPartyBtn2" aria-label="Create watch party">
                            <i class="bx bx-plus"></i> Create Party
                        </button>
                        <button class="btn btn-outline" id="joinPartyBtn2" aria-label="Join watch party">
                            <i class="bx bx-group"></i> Join Party
                        </button>
                        <button class="btn btn-primary d-none" id="startVideoCallBtn" aria-label="Start video call">
                            <i class="bx bx-video"></i> Start Video Call
                        </button>
                        <button class="btn btn-danger d-none" id="leavePartyBtn2" aria-label="Leave watch party">
                            <i class="bx bx-exit"></i> Leave Party
                        </button>
                    </div>
                    <div class="party-info d-none" id="partyInfoContainer">
                        <div class="party-info-item">
                            <span>Party Name:</span>
                            <strong id="partyNameDisplay">Movie Night</strong>
                        </div>
                        <div class="party-info-item">
                            <span>Members:</span>
                            <strong id="partyMemberCount">1</strong>
                        </div>
                        <div class="party-info-item">
                            <span>Code:</span>
                            <strong id="partyCodeDisplay"></strong>
                            <button class="copy-btn" id="copyPartyCodeBtn" aria-label="Copy party code">
                                <i class="bx bx-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="cast-section">
                    <h3>Cast</h3>
                    <div class="cast-grid">
                        <div class="nav-arrow-left"><i class="material-icons-round">chevron_left</i></div>
                        <div class="cast-scroller" id="castGrid"></div>
                        <div class="nav-arrow-right"><i class="material-icons-round">chevron_right</i></div>
                    </div>
                </div>
                <div class="reviews-section">
                    <div class="reviews-header">
                        <h3>User Reviews</h3>
                        <button class="btn btn-outline" id="writeReviewBtn">Write a Review</button>
                    </div>
                    <div class="review-form" id="review-form">
                        <div class="form-header">
                            <h4>Write Your Review</h4>
                            <div class="star-rating">
                                <i class="bx bx-star" data-rating="1"></i>
                                <i class="bx bx-star" data-rating="2"></i>
                                <i class="bx bx-star" data-rating="3"></i>
                                <i class="bx bx-star" data-rating="4"></i>
                                <i class="bx bx-star" data-rating="5"></i>
                            </div>
                        </div>
                        <textarea placeholder="Share your thoughts about this movie..." id="reviewText" aria-label="Write your review"></textarea>
                        <div class="form-actions">
                            <button class="btn btn-outline" id="cancelReviewBtn">Cancel</button>
                            <button class="btn btn-primary" id="submitReviewBtn">Submit</button>
                        </div>
                    </div>
                    <div class="reviews-list" id="user-reviews"></div>
                </div>
                <footer class="footer">
                    <div class="footer-top">
                        <div class="container">
                            <div class="footer-brand-wrapper">
                                <a href="/" class="logo"></a>
                                <ul class="footer-list">
                                    <li><a href="/" class="footer-link">Home</a></li>
                                    <li><a href="/movies" class="footer-link">Movies</a></li>
                                    <li><a href="/tv" class="footer-link">TV Shows</a></li>
                                    <li><a href="/series" class="footer-link">Web Series</a></li>
                                    <li><a href="/pricing" class="footer-link">Pricing</a></li>
                                </ul>
                            </div>
                            <div class="footer-column">
                                <h4>Company</h4>
                                <ul class="footer-list">
                                    <li><a href="/about" class="footer-link">About Us</a></li>
                                    <li><a href="/careers" class="footer-link">Careers</a></li>
                                    <li><a href="/press" class="footer-link">Press</a></li>
                                </ul>
                            </div>
                            <div class="footer-column">
                                <h4>Support</h4>
                                <ul class="footer-list">
                                    <li><a href="/faq" class="footer-link">FAQ</a></li>
                                    <li><a href="/help" class="footer-link">Help Center</a></li>
                                    <li><a href="/contact" class="footer-link">Contact Us</a></li>
                                </ul>
                            </div>
                            <div class="footer-column">
                                <h4>Legal</h4>
                                <ul class="footer-list">
                                    <li><a href="/terms" class="footer-link">Terms of Use</a></li>
                                    <li><a href="/privacy" class="footer-link">Privacy Policy</a></li>
                                    <li><a href="/cookies" class="footer-link">Cookie Policy</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="footer-bottom">
                        <div class="container">
                            <ul class="social-list">
                                <li><a href="#" class="social-link"><ion-icon name="logo-facebook"></ion-icon></a></li>
                                <li><a href="#" class="social-link"><ion-icon name="logo-twitter"></ion-icon></a></li>
                                <li><a href="#" class="social-link"><ion-icon name="logo-pinterest"></ion-icon></a></li>
                                <li><a href="#" class="social-link"><ion-icon name="logo-linkedin"></ion-icon></a></li>
                            </ul>
                            <p class="copyright">© 2025 <a href="#">CodeTech</a>. All Rights Reserved.</p>
                            <img src="/assets/images/footer-bottom-img.png" alt="Payment partners" class="footer-bottom-img" loading="lazy">
                        </div>
                    </div>
                </footer>
            </section>
            <!-- Right Section -->
            <aside class="sidebar right-section" id="sidebar">
                <div class="sidebar-tabs">
                    <button class="sidebar-tab active" data-tab="recommended">
                        <i class="material-icons-round">recommend</i>
                        <span>Recommended</span>
                    </button>
                    <button class="sidebar-tab" data-tab="chat">
                        <i class="material-icons-round">forum</i>
                        <span>Live Chat</span>
                        <span class="notification-badge" id="unreadMessagesCount">0</span>
                    </button>
                </div>

                <div class="sidebar-section active" id="recommendedVideos" data-tab-content="recommended">
                    <!-- Recommended videos will load here when tab is active -->
                </div>

                <div class="sidebar-section" id="activePartyView" data-tab-content="chat">
                    <!-- Party Header (visible when in party) -->
                    <div class="section-header party-header" id="partyHeader" style="display: none;">
                        <h4>
                            <i class="material-icons-round">local_movies</i>
                            Watch Party
                            <span class="party-status-indicator online"></span>
                            <span class="party-id" id="partyCodeDisplayHeader"></span>
                        </h4>
                        <div class="party-header-actions">
                            <button class="btn-icon party-code-btn" id="partyCodeBtn" title="Copy Party Code">
                                <i class="material-icons-round">content_copy</i>
                                <span class="party-code" id="partyCodeDisplaySidebar"></span>
                            </button>
                            <button class="btn-icon members-toggle" id="toggleMembersBtn" title="Online Members">
                                <i class="material-icons-round">people</i>
                                <span class="online-count" id="onlineMembersCount">0</span>
                            </button>
                        </div>
                    </div>

                    <!-- Public Chat Header (visible when not in party) -->
                    <div class="section-header public-chat-header" id="publicChatHeader">
                        <h4>
                            <i class="material-icons-round">forum</i>
                            Public Chat
                        </h4>
                        <div class="party-header-actions">
                            <button class="btn-icon members-toggle" id="togglePublicMembersBtn" title="Online Users">
                                <i class="material-icons-round">people</i>
                                <span class="online-count" id="publicOnlineCount">0</span>
                            </button>
                        </div>
                    </div>

                    <!-- Online Members Popup -->
                    <div class="online-members-popup stylish-popup" id="onlineMembersPopup">
                        <div class="popup-header">
                            <h5 id="membersPopupTitle">Participants</h5>
                            <div class="popup-controls">
                                <button class="btn-icon mute-all-btn" id="muteAllBtn" title="Mute all users' audio">
                                    <i class="material-icons-round">volume_off</i>
                                    <span>Mute All</span>
                                </button>
                                <button class="btn-icon close-popup" id="closeMembersPopup" aria-label="Close members popup">
                                    <i class="material-icons-round">close</i>
                                </button>
                            </div>
                        </div>
                        <div class="members-search">
                            <input type="text" placeholder="Search participants..." id="membersSearch" aria-label="Search members">
                            <i class="material-icons-round">search</i>
                        </div>
                        <div class="members-list stylish-members-list" id="partyMembersList">
                            <!-- Members will be populated here -->
                        </div>
                    </div>

                    <!-- Chat Area -->
                    <div class="chat-container" id="chatSection">
                        <div class="chat-messages" id="chatMessages">
                            <div class="welcome-message">
                                <i class="material-icons-round">forum</i>
                                <h5>Public Chat</h5>
                                <p>You can chat here without joining a party.</p>
                            </div>
                        </div>

                        <div class="chat-input-container">
                            <button class="btn-icon emoji-picker-btn" id="emojiPickerBtn" title="Emoji">
                                <i class="material-icons-round">mood</i>
                            </button>
                            <div class="input-wrapper">
                                <input type="text" id="chatInput" placeholder="Type a message..." maxlength="500" aria-label="Type a message">
                                <div class="input-actions">
                                    <button class="btn-icon attachment-btn" id="attachmentBtn" title="Attach file (not implemented)" disabled>
                                        <i class="material-icons-round">attach_file</i>
                                    </button>
                                    <span class="char-counter">0/500</span>
                                </div>
                            </div>
                            <button class="btn send-btn" id="sendMessage" title="Send" aria-label="Send message">
                                <i class="material-icons-round">send</i>
                            </button>
                        </div>
                    </div>

                    <!-- Party Controls (visible when in party) -->
                    <div class="party-controls" id="partyControls" style="display: none;">
                        <button class="control-btn play-pause" id="partyPlayPause" title="Play/Pause" aria-label="Play or Pause party video">
                            <i class="material-icons-round">play_arrow</i>
                        </button>
                        <button class="control-btn sync" id="partySync" title="Sync with host" aria-label="Sync video with host">
                            <i class="material-icons-round">sync</i>
                        </button>
                        <button class="control-btn user-volume" id="partyVolume" title="User Audio" aria-label="Adjust user audio">
                            <i class="material-icons-round">volume_up</i>
                        </button>
                        <div class="divider"></div>
                        <button class="control-btn mic-toggle" id="toggleMicBtnSidebar" title="Mute microphone" data-enabled="true" aria-label="Toggle microphone">
                            <i class="material-icons-round">mic</i>
                        </button>
                        <button class="control-btn leave-btn" id="leavePartyBtn" title="Leave party" aria-label="Leave watch party">
                            <i class="material-icons-round">exit_to_app</i>
                        </button>
                    </div>

                    <!-- Public Chat Controls (visible when not in party) -->
                    <div class="public-chat-controls" id="publicChatControls">
                        <button class="control-btn user-volume" id="publicVolumeControl" title="Toggle Chat Sound">
                            <i class="material-icons-round">volume_up</i>
                        </button>
                        <div class="divider"></div>
                        <button class="control-btn clear-chat" id="clearChatBtn" title="Clear Chat">
                            <i class="material-icons-round">delete</i>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- User Action Menu -->
            <div class="user-action-menu" id="userActionMenu">
                <button class="action-btn block-user" data-action="block" aria-label="Block user">
                    <i class="material-icons-round">block</i> Block User
                </button>
                <button class="action-btn report-user" data-action="report" aria-label="Report user">
                    <i class="material-icons-round">report</i> Report User
                </button>
                <div class="host-actions" id="hostActions" style="display: none;">
                    <button class="action-btn kick-user" data-action="kick" aria-label="Kick user">
                        <i class="material-icons-round">person_remove</i> Kick User
                    </button>
                    <button class="action-btn ban-user" data-action="ban" aria-label="Ban user">
                        <i class="material-icons-round">gavel</i> Ban User
                    </button>
                    <button class="action-btn timeout-user" data-action="timeout" aria-label="Timeout user">
                        <i class="material-icons-round">timer</i> Timeout User
                    </button>
                </div>
                <button class="action-btn close-menu" data-action="close" aria-label="Close menu">
                    <i class="material-icons-round">close</i> Cancel
                </button>
            </div>

            <!-- Emoji Picker -->
            <div class="emoji-picker-container" id="emojiPickerContainer">
                <div class="emoji-picker-header">
                    <h6>Select Emoji</h6>
                    <button class="btn-icon close-emoji-picker" id="closeEmojiPicker" aria-label="Close emoji picker">
                        <i class="material-icons-round">close</i>
                    </button>
                </div>
                <div class="emoji-categories">
                    <button class="emoji-category-btn active" data-category="smileys" aria-label="Smileys emojis">
                        <i class="material-icons-round">mood</i>
                    </button>
                    <button class="emoji-category-btn" data-category="animals" aria-label="Animals emojis">
                        <i class="material-icons-round">pets</i>
                    </button>
                    <button class="emoji-category-btn" data-category="food" aria-label="Food emojis">
                        <i class="material-icons-round">fastfood</i>
                    </button>
                    <button class="emoji-category-btn" data-category="activities" aria-label="Activities emojis">
                        <i class="material-icons-round">sports_soccer</i>
                    </button>
                </div>
                <div class="emoji-grid" id="emojiGrid" role="grid" aria-label="Emoji selection grid">
                    <!-- Emojis will be populated here -->
                </div>
            </div>

            <!-- Watch Party Popup -->
            <div id="watchPartyPopup" class="modal-overlay hidden">
                <div class="modal-container party-modal">
                    <div class="modal-header">
                        <h2>Watch Party</h2>
                        <button class="close-btn" id="closePartyPopup" aria-label="Close watch party popup">
                            <i class="bx bx-x"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- Party Tabs -->
                        <div class="party-tabs">
                            <button class="party-tab active" data-tab="create" aria-label="Create party tab">Create Party</button>
                            <button class="party-tab" data-tab="join" aria-label="Join party tab">Join Party</button>
                            <button class="party-tab" data-tab="public" aria-label="Public parties tab">Public Parties</button>
                            <button class="party-tab hidden" data-tab="active" id="activePartyTab" aria-label="Active party tab">Active Party</button>
                        </div>
                        <!-- Create Party Tab -->
                        <div class="party-tab-content active" data-tab-content="create">
                            <form id="createPartyForm" class="party-form">
                                <div class="form-group">
                                    <label for="partyName">Party Name</label>
                                    <input type="text" id="partyName" placeholder="Enter party name" required aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label for="partyPrivacy">Privacy</label>
                                    <select id="partyPrivacy" aria-label="Select party privacy">
                                        <option value="public">Public</option>
                                        <option value="private">Private</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="partyPassword">Password (Optional)</label>
                                    <input type="password" id="partyPassword" placeholder="Enter password" aria-label="Party password">
                                </div>
                                <div class="form-group">
                                    <label for="maxMembers">Max Members</label>
                                    <select id="maxMembers" aria-label="Select maximum members">
                                        <option value="10">10</option>
                                        <option value="25">25</option>
                                        <option value="50" selected>50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                                <!-- Party Features -->
                                <div class="party-features">
                                    <h4>Features</h4>
                                    <div class="feature-toggles">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="enableVideoCall" checked aria-label="Enable video calling">
                                            <span class="slider"></span>
                                            Video Calling
                                        </label>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="enableVoiceChat" checked aria-label="Enable voice chat">
                                            <span class="slider"></span>
                                            Voice Chat
                                        </label>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="enableTextChat" checked aria-label="Enable text chat">
                                            <span class="slider"></span>
                                            Text Chat
                                        </label>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="enableHostControls" checked aria-label="Enable host only controls">
                                            <span class="slider"></span>
                                            Host Only Controls
                                        </label>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn btn-outline" id="cancelCreateParty" aria-label="Cancel create party">Cancel</button>
                                    <button type="submit" class="btn btn-primary" id="confirmCreateParty" aria-label="Confirm create party">Create Party</button>
                                </div>
                            </form>
                        </div>
                        <!-- Join Party Tab -->
                        <div class="party-tab-content" data-tab-content="join">
                            <form id="joinPartyForm" class="party-form">
                                <div class="form-group">
                                    <label for="partyCode">Party Code</label>
                                    <input type="text" id="partyCode" placeholder="Enter party code" required aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label for="joinPassword">Password (if required)</label>
                                    <input type="password" id="joinPassword" placeholder="Enter password" aria-label="Party password">
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn btn-outline" id="cancelJoinParty" aria-label="Cancel join party">Cancel</button>
                                    <button type="submit" class="btn btn-primary" id="confirmJoinParty" aria-label="Confirm join party">Join Party</button>
                                </div>
                            </form>
                        </div>
                        <!-- Public Parties Tab -->
                        <div class="party-tab-content" data-tab-content="public">
                            <div class="public-parties-header">
                                <h4>Public Parties</h4>
                                <button class="btn btn-sm btn-outline" id="refreshPublicParties" aria-label="Refresh public parties">
                                    <i class="bx bx-refresh"></i>
                                    Refresh
                                </button>
                            </div>
                            <div class="public-parties-list" id="publicPartiesList">
                                <div class="empty-state">
                                    <i class="bx bx-group"></i>
                                    <p>No public parties available</p>
                                    <p class="text-muted">Create your own party or check back later!</p>
                                </div>
                            </div>
                        </div>
                        <!-- Active Party Tab -->
                        <div class="party-tab-content" data-tab-content="active" id="activePartyView">
                            <div class="active-party-info">
                                <h3 id="activePartyName">Party Name</h3>
                                <p class="party-code">Code: <strong id="activePartyCode"></strong></p>
                                <p class="party-status">Status: <span id="activePartyStatus">Active</span></p>
                                <p class="party-video">Video: <span id="activePartyVideoId"></span></p>
                                <p class="member-count">Members: <span id="activePartyMemberCount">0</span></p>
                                <button class="btn btn-sm btn-outline" id="copyActivePartyCodeBtn" aria-label="Copy active party code">
                                    <i class="bx bx-copy"></i>
                                    Copy Code
                                </button>
                            </div>
                            <!-- Party Controls -->
                            <div class="party-controls">
                                <h4>Controls</h4>
                                <div class="control-buttons">
                                    <button class="btn btn-sm" id="popupPartyPlayPause" data-icon-on="bx bx-pause" data-icon-off="bx bx-play" aria-label="Play or Pause party video">
                                        <i class="bx bx-play"></i>
                                        Play/Pause
                                    </button>
                                    <button class="btn btn-sm" id="popupPartySeekBack" aria-label="Seek back 10 seconds">
                                        <i class="bx bx-rewind"></i>
                                        -10s
                                    </button>
                                    <button class="btn btn-sm" id="popupPartySeekForward" aria-label="Seek forward 10 seconds">
                                        <i class="bx bx-fast-forward"></i>
                                        +10s
                                    </button>
                                    <button class="btn btn-sm" id="popupPartySync" aria-label="Sync party video">
                                        <i class="bx bx-sync"></i>
                                        Sync
                                    </button>
                                    <button class="btn btn-sm" id="popupPartySettings" aria-label="Party settings">
                                        <i class="bx bx-cog"></i>
                                        Settings
                                    </button>
                                </div>
                            </div>
                            <!-- Mini Chat -->
                            <div class="popup-chat">
                                <h4>Chat</h4>
                                <div class="chat-messages-mini" id="popupPartyChatMessages"></div>
                                <div class="chat-input-container">
                                    <input type="text" id="popupPartyChatInput" placeholder="Type a message..." aria-label="Type a message">
                                    <button id="popupSendPartyMessage" class="send-btn" aria-label="Send message">
                                        <i class="bx bx-send"></i>
                                    </button>
                                </div>
                            </div>
                            <!-- Members List -->
                            <div class="popup-members">
                                <h4>Members</h4>
                                <ul class="party-member-list" id="popupPartyMembersList"></ul>
                            </div>
                            <div class="form-actions">
                                <button class="btn btn-danger" id="popupLeavePartyBtn" aria-label="Leave party">Leave Party</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Media Controls Popup -->
            <div id="mediaControlsPopup" class="modal-overlay hidden">
                <div class="modal-container media-controls-modal">
                    <div class="modal-header">
                        <h3>Media Controls</h3>
                        <button class="close-btn" id="closeMediaControls" aria-label="Close media controls popup">
                            <i class="bx bx-x"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="media-preview">
                            <video id="localVideo" muted autoplay aria-label="Local video preview"></video>
                            <div class="permission-status" id="permissionStatus"></div>
                        </div>
                        <div class="media-controls">
                            <button class="btn media-toggle" id="toggleCamera" data-enabled="false" data-icon-on="bx bx-video" data-icon-off="bx bx-video-off" aria-label="Toggle camera">
                                <i class="bx bx-video-off"></i>
                                <span>Camera Off</span>
                            </button>
                            <button class="btn media-toggle" id="toggleMicrophone" data-enabled="false" data-icon-on="bx bx-microphone" data-icon-off="bx bx-microphone-off" aria-label="Toggle microphone">
                                <i class="bx bx-microphone-off"></i>
                                <span>Mic Off</span>
                            </button>
                            <button class="btn media-toggle" id="toggleScreenShare" data-enabled="false" data-icon-on="bx bx-share" data-icon-off="bx bx-share-alt" aria-label="Toggle screen share">
                                <i class="bx bx-share-alt"></i>
                                <span>Share Screen</span>
                            </button>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-outline" id="cancelMediaControls" aria-label="Cancel media controls">Cancel</button>
                            <button class="btn btn-primary" id="confirmMediaControls" aria-label="Join with video">Join with Video</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reaction Picker -->
            <div id="reactionPicker" class="reaction-picker hidden">
                <div class="reaction-options" role="menu" aria-label="Reaction picker">
                    <button class="reaction-option" data-reaction="👍" aria-label="Thumbs up reaction">👍</button>
                    <button class="reaction-option" data-reaction="❤️" aria-label="Heart reaction">❤️</button>
                    <button class="reaction-option" data-reaction="😂" aria-label="Laughing reaction">😂</button>
                    <button class="reaction-option" data-reaction="😮" aria-label="Shock reaction">😮</button>
                    <button class="reaction-option" data-reaction="😢" aria-label="Sad reaction">😢</button>
                    <button class="reaction-option" data-reaction="🔥" aria-label="Fire reaction">🔥</button>
                    <button class="reaction-option" data-reaction="👏" aria-label="Clap reaction">👏</button>
                    <button class="reaction-option" data-reaction="🎉" aria-label="Celebration reaction">🎉</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    <script src="/assets/js/scripts.js"></script>
    <script src="/assets/js/socket.js"></script>
    <script src="/assets/js/party.js"></script>
    <script src="/assets/js/nav.js"></script>
    <script src="/assets/js/video-controls.js"></script>
    <script src="/assets/js/video.js"></script>
    <script src="/assets/js/elem.js"></script>
</body>
</html>